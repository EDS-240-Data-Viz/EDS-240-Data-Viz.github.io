---
format: 
  revealjs:
    slide-number: true
    # code-link: true
    highlight-style: a11y
    chalkboard: true
    theme: 
      - ../../meds-slides-styles.scss
editor_options: 
  chunk_output_type: inline
---

## {#title-slide data-menu-title="Title Slide" background="#053660"} 

[EDS 240: Lecture 7.1]{.custom-title}

[*Typography*]{.custom-subtitle}

<hr class="hr-teal">

[Week 7 | February 18^th^, 2026]{.custom-subtitle3}

---

## {#good-design data-menu-title="Good data viz considerations"} 

[Good data visualization design considers:]{.slide-title}

<hr>

- [**data-ink ratio** (less is more, within reason)]{.gray-text}
- [how to **reduce eye movement** and **improve readability / interpretability** (e.g. through alternative legend positions, direct annotations)]{.gray-text}
- [putting things **in context**]{.gray-text}
- how to **draw the main attention** to the most **important info**
- **consistent** use of colors, spacing, typefaces, weights
- **typeface / font choices** and how they affect both readability *and* emotions and perceptions
- using **visual hierarchy** to guide the reader
- **color choices** (incl. palette types, emotions, readability)
- [how to **tell an interesting story**]{.gray-text}
- [how to **center the people and communities** represented in your data]{.gray-text}
- [**accessibility** through colorblind-friendly palettes & alt text]{.gray-text}


::: {.center-text .teal-text}
**This lesson will focus on the use of typefaces and fonts in a good data visualization.**
:::

---

##  {#typeography data-menu-title="# Typography #" background="#047C90"}

<div class="page-center vertical-center">
<p class="custom-subtitle bottombr">Type and font choice influences audience perception and readability</p>
</div>

---

## {#typography-defs data-menu-title="Typeography definitions"} 

[Typeface vs. font]{.slide-title}

<hr>

:::: {.columns}

::: {.column width="50%"}

**[Typeface](https://fonts.google.com/knowledge/glossary/typeface){target="_blank"} (aka font family)**: underlying visual design (e.g. Times New Roman, Helvetica, Roboto)

```{r typeface}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "nunito-type.png"))
```
:::

::: {.column width="50%"}

**[Font](https://fonts.google.com/knowledge/glossary/font){target="_blank"}**: an implementation of a typeface; they can come in different weights and styles (e.g. bold, italic)

```{r font}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "nunito-fonts.png"))
```
:::

::::

. . .

:::: {.columns}

::: {.column width="50%" .center-text}
**You choose a *typeface* (e.g. [Nunito](https://fonts.google.com/specimen/Nunito?query=nunito){target="_blank"})**
:::

::: {.column width="50%" .center-text}
**You use a *font* (e.g.** regular, *italic*, **bold)**
:::

::::

---

## {#typography-importance data-menu-title="Typography is important!"} 

[Typeface choices affect emotions and perceptions]{.slide-title2}

<hr>

:::: {.columns}

::: {.column width="50%"}

```{r font-psychology}
#| eval: true
#| echo: false
#| out-width: "70%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "psychology-fonts.png"))
```

:::

::: {.column width="50%"}

<br>
<br>

> *"Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed."*

::: {.right-align-text .body-text-s}
-[Wikipedia](https://en.wikipedia.org/wiki/Typography){target="_blank"}
:::

<br>


Similar to colors, typefaces / fonts influence the how viewers perceive information (check out this short [TEDx talk](https://www.youtube.com/watch?v=OXc-VZ4Vwbo){target="_blank"}).

<br>

[{{< fa arrow-left title="an arrow pointing to the left" >}} Source: [The Daily Egg](https://www.crazyegg.com/blog/psychology-of-fonts-infographic/){target="_blank"}]{.body-text-s .gray-text}

:::

::::

::: {.footer}
Want to dive deeper into the world of typography? Start with this quick read, [Why care about typography?](https://fonts.google.com/knowledge/introducing_type/why_care_about_typography){target="_blank"} and explore other great articles by [Google Fonts](https://fonts.google.com/knowledge){target="_blank"}.
:::

---

## {#font-psychology data-menu-title="Psychology of typefaces"} 

[Context matters - choose typeface accordingly]{.slide-title2}

<hr>

Typefaces and fonts communicate beyond more than just the written text -- they can **evoke emotions** and can be used to **better connect your audience with your work**. 

<br>

```{r find-you}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "find-you.png"))
```

::: {.center-text .body-text-s .gray-text}
Source: [Typography for a better user experience](https://www.suvoray.com/notes/typography-for-a-better-user-experience){target="_blank"}, by [Suvo Ray](https://www.suvoray.com/){target="_blank"}
:::

<br>

::: {.footer}
Interested in font psychology? Check out this [short video](https://www.youtube.com/watch?v=6Jlo9iOZvXY&t=65s){target="_blank"} and [this article](https://designmodo.com/font-psychology/#:~:text=Serif%20fonts%20can%20evoke%20feelings,modernity%2C%20simplicity%2C%20and%20clarity.){target="_blank"} to learn a bit more.
:::

---

## {#discuss-typography data-menu-title="Discuss typogrpahy"} 

[Consider the text on this visualizaton]{.slide-title}

<hr>

**What typography choices did the author(s) of this visualization make?** With you learning partner(s), consider all the various pieces of text on this visualization:

```{r discuss-viz}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "typography-discuss.jpg"))
```

```{r countdown-discuss-viz} 
countdown::countdown(
  minutes = 2,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#sans-serifs data-menu-title="Use sans-serif fonts"} 

[When in doubt, use sans-serif fonts]{.slide-title}

<hr>

**Serif fonts** have small decorative lines (aka "tails" or "feet") that extend off characters while **sans serif fonts** don't. 

<br>

:::: {.columns}

::: {.column width="50%"}
```{r sans-v-serif}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "sans-vs-serif-fonts.png"))
```
:::

::: {.column width="50%" .incremental}
- **Sans-serif** fonts = **cleaner** and easier to read.
  - [[Roboto](https://fonts.google.com/specimen/Roboto){target="_blank"}, [Lato](https://fonts.google.com/specimen/Lato){target="_blank"}, [Open Sans](https://fonts.google.com/specimen/Open+Sans){target="_blank"} are good, free options]{.body-text-s}
- **Serif** fonts = classy / traditional / professional / serious tone; typically only used for **visualization headlines**
  - [If your organization uses a serif font, consider using it in your visualization's headline]{.body-text-s}
:::

::::

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#lining data-menu-title="Lining figures"} 

[Use a typeface with lining figures for numerals]{.slide-title2}

<hr>

Different typefaces display numbers differently. Serif fonts tend to have "oldstyle figures", which extend above and below the "line" -- these can be difficult to read in a visualization. 

**Instead, look for options with lining figures, where numbers "line up", i.e. they're all the same height.**

<br>

```{r lining}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "lining.png"))
```

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#monospaced data-menu-title="Monospaced font for numbers"} 

[Use a monospaced typeface for numerals]{.slide-title}

<hr>

<br>

Typefaces with **tabular figures** print **every character with equal width** -- you may see these referred to as **monospaced** typefaces. These work well in tables, visualizations, or any scenario where figures should line up vertically (see how you can quickly identify how many figures a number has in the table on the right, below).

:::: {.columns}

::: {.column width="50%"}
<br>
<br>

```{r tab-figs}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "tabular-figures.png"))
```
:::

::: {.column width="50%"}
```{r tab-google}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "tabular-google.svg"))
```
:::

::::

::: {.footer}
Examples from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth & [Understanding numerals](https://fonts.google.com/knowledge/introducing_type/understanding_numerals#when-to-use-tabular-lining-numerals){target="_blank"} article by Google Fonts
:::

---

## {#symbols data-menu-title="Symbols"} 

[Use a typeface with all the symbols you need]{.slide-title2}

<hr>

<br>

Confirm that all symbols (aka **glyphs**) that you need exist *and* that they look good for your chosen typeface.

<br>

```{r symbols}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "symbols.png"))
```

<br>

Consider special characters for different languages, currency symbols, math symbols, reference marks, sub / superscript numbers, etc.

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#bold data-menu-title="Bold font"} 

[Use bold fonts for emphasis only]{.slide-title}

<hr>

[**Most typefaces come with fonts for different weights** (Google Fonts uses numbers for font weights -- extra light (200), light (300), regular (400, default), medium (500), semi bold (600), bold (700), extra bold (800)).]{.body-text-s} 

[**Use bold text for titles or to emphasize a few words in annotations.** Regular or medium weights are often easiest for longer text (descriptions, annotations, notes).]{.body-text-s} 

<br>

```{r bold}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "bold.png"))
```

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#thin data-menu-title="Thin font"} 

[Avoid really thin fonts]{.slide-title}

<hr>

Thin (light-weight fonts) fonts are hard to read. **Only use them in a high-contrast color and in large sizes** (e.g. for titles).

<br>

```{r thin}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "thin.png"))
```

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#large-font-size data-menu-title="Large enough font size"} 

[Ensure your font size is large enough]{.slide-title}

<hr>

**Make sure your font size is large enough, especially when presenting visualizations in a slide-based presentation** (this oftentimes means increasing it larger than you would have it in print). In ggplot, adjust font sizes using `theme()`.

<br>

```{r large-text}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "large-enough-text.png"))
```

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#contrast data-menu-title="High contrast font color"} 

[Use high-contrast color for most text]{.slide-title}

<hr>

[[Web Content Accessibility Guidelines](https://www.w3.org/TR/WCAG21/#:~:text=Web%20Content%20Accessibility%20Guidelines%20(WCAG)%202.1%20defines%20how%20to%20make,%2C%20learning%2C%20and%20neurological%20disabilities.){target="_blank"} (WCAG) recommends **a minimum contrast ratio of 4.5:1** -- use a color contrast checker to check your ratio. The **[Coolers color contrast checker](https://coolors.co/contrast-checker/112a46-acc8e5){target="_blank"}** will enhance poor color combinations to meet WCAG guidelines. For example, here is a color combo with a [bad contrast ratio](https://coolors.co/contrast-checker/5cdc8d-ffffff){target="_blank"}, and here is the updated color combo with an [improved contrast ratio](https://coolors.co/contrast-checker/104c27-ffffff){target="_blank"}.]{.body-text-s}

<br>

```{r contrast}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "contrast-ratio.png"))
```

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#uppercase data-menu-title="Use uppercase sparingly"} 

[Use UPPERCASE text sparingly]{.slide-title}

<hr>

Uppercase text is more difficult to read compared to sentence case -- **limit use to headlines or labels**. Region labels on maps are commonly uppercase (e.g. see maps in these New York Times pieces, [How to Think About Ukraine, in Maps and Charts](https://www.nytimes.com/interactive/2022/02/25/opinion/russia-ukraine-invasion-maps.html){target="_blank"} and [Closing the Back
Door to Europe](https://www.nytimes.com/interactive/2015/09/15/world/europe/migrant-borders-europe.html){target="_blank"}).

```{r uppercase}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "uppercase.png"))
```

<br>

::: {.footer}
Example from [Which fonts to use for your charts and tables](https://blog.datawrapper.de/fonts-for-data-visualization/){target="_blank"}, by 
Lisa Charlotte Muth
:::

---

## {#typographic-hierarchy data-menu-title="Typographic hierarchy"} 

[Typographic hierarchy]{.slide-title}

<hr>

**No one wants to read a wall of text.** You can use font size, style, color, spacing, and typeface (or combinations of these) to create a hierarchy that guide your readers.

<br>

```{r hierarchy}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "hierarchy.png"))
```

<br>

::: {.center-text .gray-text .body-text-s}
Source: [The UX Designerâ€™s Guide to Typography](https://www.interaction-design.org/literature/article/the-ux-designer-s-guide-to-typography){target="_blank"}
:::

---

## {#recap-font-choices data-menu-title="Recap: font choices"} 

[Recap: choosing the right typeface(s) & font(s)]{.slide-title2}

<hr>

::: {.incremental}
- **context matters** -- the type(s) should fit the topic and audience
- when in doubt, **use a sans-serif style** 
- choose a **monospaced** typeface with **lining figures** for numbers
- ensure that your chosen typeface **has all the symbols you need *and* that they look okay**
- use **bold fonts for emphasis** and **avoid thin fonts** 
- make **font sizes large enough** to easily read
- use **high-contrast** font colors
- strategically use types & fonts to **create hierarchy** 
- avoid (extensively) using **ALL CAPS**
:::

. . . 

::: {.teal-text .body-text-m .center-text}
**Avoid using too many typefaces (stick to just 1-3)**
:::

::: {.center-text}
**Check out [fontpair.co](https://www.fontpair.co/){target="_blank"} to explore aesthetically-pleasing font pairings!**
:::

. . . 

::: {.footer}
There are *lots* of excellent resources out there for choosing the right typeface / font -- check out the [resources page](../../resources.qmd#typography){target="_blank"} on the course website for some recommendations.
:::

---

## {#nicault-horror data-menu-title="C Nicault (Horror Movies)"} 

```{r horror}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "nicault-horror.png"))
```

::: {.center-text .body-text-s .gray-text}
Horror Movies, by [Cristophe Nicault](https://www.christophenicault.com/){target="_blank"} ([source code](https://github.com/cnicault/tidytuesday/blob/master/2022/2022-44-horror-movies/horror_movies.qmd){target="_blank"})
:::


```{r horror-countdown}
countdown::countdown(
  minutes = 1,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

## {#anyene-hbcu data-menu-title="I Anyene (HBCUs)"} 

```{r hbcu}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "anyene-hbcu.png"))
```

::: {.center-text .body-text-s .gray-text}
HBCUs, by [Ijeamaka Anyene](https://ijeamaka-anyene.netlify.app/){target="_blank"} ([source code](https://github.com/Ijeamakaanyene/tidytuesday/blob/master/scripts/2021_04_hbcu.Rmd){target="_blank"})
:::


```{r hbcu-countdown}
countdown::countdown(
  minutes = 1,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

## {#rennie-rladies data-menu-title="N Rennie (R-Ladies Events)"} 

```{r rladies}
#| eval: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "rennie-rladies.png"))
```

::: {.center-text .body-text-s .gray-text}
R-Ladies Chapter Events, by [Nicola Rennie](https://ijeamaka-anyene.netlify.app/){target="_blank"} ([source code](https://github.com/nrennie/tidytuesday/tree/main/2023/2023-11-21){target="_blank"}) | Font inspired by [R-Ladies Global](https://rladies.org/){target="_blank"}
:::


```{r rladies-countdown}
countdown::countdown(
  minutes = 1,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

##  {#change-fonts data-menu-title="# Code example #" background="#047C90"}

<div class="page-center vertical-center">
<p class="custom-subtitle bottombr">Let's learn how to use different fonts in our ggplots!</p>
</div>

---

## {#sys-fonts1 data-menu-title="System fonts 1"} 

[The problem with system fonts]{.slide-title}

<hr>

A **[[system font](https://fonts.google.com/knowledge/glossary/system_font_web_safe_font){target="_blank"}]{.teal-text} is one that's already assumed to be on the vast majority of users' devices**, with no need for a web font to be downloaded.

. . . 

[There are **only three system fonts  that are guaranteed to work everywhere**: **[sans]{.teal-text}** (the default), **[serif]{.teal-text}**, or **[mono]{.teal-text}**. Use the `family` argument to specify which font family you'd like to use for a particular text element, and use the `face` argument to specify font face (**bold**, *italic*, plain (default)):]{.body-text-s}

```{r sys-fonts}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| output-location: column
library(palmerpenguins)
library(tidyverse)

ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() + 
  labs(title = "This title is serif font",
       subtitle = "This subtitle is mono font",
       x = "This axis label is sans font\n(default)",
       y = "This axis is also sans font\n(default)") +
  theme(
    plot.title = element_text(family = "serif", size = 30),
    plot.subtitle = element_text(family = "mono", size = 25),
    axis.title = element_text(family = "sans", size = 22),
    axis.text.x = element_text(family = "serif", face = "bold", size = 18),
    axis.text.y = element_text(family = "mono", face = "italic", size = 18)
    )
```

---

## {#sys-fonts2 data-menu-title="System fonts 2"} 

[The problem with system fonts]{.slide-title}

<hr>

**A graphics device (GD) is something used to make a plot appear** -- every time you create a plot in R, it needs to be sent to a specific GD to be rendered. There are two main device types:

<br>

. . . 

1. **screen devices:** the most common place for your plot to be "sent" -- whenever our plot appears in a window on our computer screen, it's being sent to a screen device; different operating systems (e.g. Mac, Windows, Linux) have different screen devices
2. **file devices:** if we want to write (i.e. save) our plot to a file, we can send our plot to a particular file device (e.g. pdf, png, jpeg)

<br>

. . .

**Unfortunately, text drawing is handled differently by each graphics device**, which means that if we want a font to work everywhere, we need to configure all these different devices in different ways.

::: {.footer}
Run `?Devices` in your console to see which devices are supported by your installation of R.

Read a bit more about graphics devices in [Chapter 8](https://bookdown.org/rdpeng/exdata/graphics-devices.html){target="_blank"} of [Exploratory Data Analysis with R](https://bookdown.org/rdpeng/exdata/){target="_blank"}, by [Roger Peng](https://rdpeng.org/){target="_blank"}
:::

---

## {#font-pkgs data-menu-title="Font packages"} 

[R packages to the rescue!]{.slide-title}

<hr>

Fortunately, there are a couple super handy packages that make working with fonts a little bit easier:

- [`{showtext}`](https://github.com/yixuan/showtext){target="_blank"} 
- [`{extrafont}`](https://github.com/wch/extrafont){target="_blank"}

<br>

:::: {.columns}

::: {.column width="50%"}
```{r showtext}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "60%"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "showtext.png"))
```
:::

::: {.column width="50%"}
<br>

[**We'll be using `{showtext}`** for a couple reasons: it supports more file formats *and* more graphics devices, and it also avoids using external software (`{extrafont}` requires that you install some additional software and packages first). `{showtext}` makes is easy to import and use [Google Fonts](https://fonts.google.com/){target="_blank"}.]{.body-text-s}
:::

::: {.footer}
[Albert Rapp](https://albert-rapp.de/posts/ggplot2-tips/08_fonts_and_icons/08_fonts_and_icons.html){target="_blank"} and [Nicola Rennie](https://nrennie.rbind.io/blog/adding-social-media-icons-ggplot2/){target="_blank"} both have written great blog posts on using `{showtext}`. These materials draw from both their work!
:::

::::

::: {.notes}
- re: opening a new GD, `windows()` after `showtext_auto()` <https://gradientdescending.com/adding-custom-fonts-to-ggplot-in-r/>
:::

---

## {#original-dumbbell data-menu-title="Recall original dumbbell"} 

[Recall our dumbbell plot from the amounts / rankings lecture]{.slide-title2}

<hr>

Let's improve this plot by adding text, modifying the theme, and using some new fonts!

{{< include sections/dumbbell-original.qmd >}}

---

## {#wrangle-data data-menu-title="Wrangle data"} 

[Wrangle data]{.slide-title}

<hr>

This code should look familiar (copied from the [amounts / rankings lecture](SLIDES-amounts-rankings.qmd){target="_blank"}):

```{r dumbbell-original-wrangle}
#| eval: true
#| echo: true
#| out-width: "50%"
#| fig-align: "center"

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)

#..........................import data...........................
iwa_data <- read_csv(here::here("course-materials", "data", "lecture", "combined_iwa-assessment-outputs-conus-2025_CONUS_200910-202009_long.csv"))

#..................create df of subregions names.................
# data only contain HUC codes; must manually join names if we want to include those in our viz (which we do! we'll mainly be looking at CA subregions)
# subregions (& others) identified in: https://water.usgs.gov/GIS/wbd_huc8.pdf
# there may be a downloadable dataset containing HUCs & names out there...but I couldn't find it
subregion_names <- tribble(
  ~subregion_HUC, ~subregion_name,
  "1801", "Klamath-Northern California Coastal",
  "1802", "Sacramento",
  "1803", "Tulare-Buena Vista Lakes",
  "1804", "San Joaquin",
  "1805", "San Francisco Bay",
  "1806", "Central California Coastal",
  "1807", "Southern California Coastal",
  "1808", "North Lahontan", 
  "1809", "Northern Mojave-Mono Lake",
  "1810", "Southern Mojave-Salton Sea",
)

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                wrangle data                              ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#......create df with just CA water resource region (HUC 18).....
ca_region <- iwa_data |> 
  clean_names() |> 
  mutate(region_HUC = str_sub(string = huc12_id, start = 1, end = 2),
         subregion_HUC = str_sub(string = huc12_id, start = 1, end = 4)) |> 
  filter(region_HUC == "18") |> 
  separate_wider_delim(cols = year_month,
                       delim = "-",
                       names = c("year", "month")) |>                            
  mutate(year = as.numeric(year),
         month = as.numeric(month)) |> 
  left_join(subregion_names) |> 
  select(year, month, huc12_id, region_HUC, subregion_HUC, subregion_name, availab_mm_mo, consum_mm_mo, sui_frac)

#.................create df of just SBC subbasin.................
sbc_subbasin_monthly <- ca_region |> 
  mutate(subbasin_HUC = str_sub(string = huc12_id, start = 1, end = 8)) |> 
  filter(subbasin_HUC == "18060013") |> #
  group_by(month) |> 
  summarize(mean_avail = mean(availab_mm_mo, na.rm = TRUE),
            mean_consum = mean(consum_mm_mo, na.rm = TRUE)) |> 
  mutate(month = month.abb[month],
         month = factor(month, levels = rev(c(month.abb[10:12], month.abb[1:9]))))
```        

---

## {#original-plot-code data-menu-title="Original plot (code)"} 

[Code for our original plot]{.slide-title}

<hr>

This code was copied from the [amounts / rankings lecture](SLIDES-amounts-rankings.qmd){target="_blank"}. Resulting plot is rendered on the next slide.

```{r original-plot-code}
#| eval: false
#| echo: true
#| fig-align: "center"
#| out-width: "100%"
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    plot                                  ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = "#448F9C", 
             size = 5,
             stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = "#9C7344", 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(x = "Mean monthly water availability & consumption (mm)") +
  theme(axis.title.y = element_blank())
```

---

## {#original-plot-viz data-menu-title="Original plot (viz)"} 

```{r original-plot-viz}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.7
#| out-width: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = "#448F9C", 
             size = 5,
             stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = "#9C7344", 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(x = "Mean monthly water availability & consumption (mm)") +
  theme(axis.title.y = element_blank())
```

---

## {#create-palette data-menu-title="Create a named palette"} 

[Create a named palette]{.slide-title}

<hr>

**Let's create a named vector of colors** to call from. In addition to our point colors, we'll also include colors for our plot's text:

```{r create-palette}
#| eval: true
#| echo: true
pal <- c("avail" = "#448F9C",
         "consum" = "#9C7344",
         "dark_gray" = "#0C1509",
         "light_gray" = "#4E514D") 
```

The primary purpose of the [`{monochromeR}` package](https://github.com/cararthompson/monochromeR){target="_blank"} is for creating monochrome color palettes, however, it also includes a **helpful function for viewing our palette**:

```{r monochromeR}
#| eval: true
#| echo: true
#| fig-align: "center"
monochromeR::view_palette(pal)
```

---

## {#apply-colors data-menu-title="Apply new colors"} 

[Apply new colors by name]{.slide-title}

<hr>

```{r apply-colors}
#| eval: true
#| echo: true
#| fig-align: "center"
#| out-width: "100%"
#| code-line-numbers: "5,9"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = pal["avail"], 
             size = 5,
             stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(x = "Mean monthly water availability & consumption (mm)") +
  theme(axis.title.y = element_blank())
```

---

## {#titles-theme-code data-menu-title="Titles & theme (code)"} 

[Add titles / caption & modify theme]{.slide-title}

<hr>

Resulting plot is rendered on the next slide.

<!-- FOR LIVE-CODING (CODE SHOWN ON SLIDE)  -->

```{r add-text-echo}
#| eval: false
#| echo: true
#| fig-align: "center"
#| out-height: "100%"
#| code-line-numbers: "4,15-38"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = "Data Source: USGS CONUS 2025",
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(face = "bold",
                              size = 17,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(size = 12,
                             color = pal["light_gray"]),
    axis.title.x = element_text(size = 13,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = element_text(face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

::: {.footer}
**Note:** We can apply our font colors in the same way we applied our point colors, calling named values from `pal`
:::

---

## {#titles-theme-viz data-menu-title="Titles & theme (viz)"} 

<!-- FOR DISPLAYING PLOT ONLY (NO CODE SHOWN ON SLIDE); ABSOLUTE SIZES CHOSEN BASED ON HOW PLOT RENDERS ON SLIDE -->

```{r add-text-eval}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5.5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             stroke = 2,
             size = 5.5) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = "Data Source: USGS CONUS 2025",
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(face = "bold",
                              size = 22,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(t = 3, b = 8)),
    axis.text = element_text(size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = element_text(face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#pick-google-fonts data-menu-title="Pick Google fonts"} 

[Pick a typeface(s) from Google Fonts]{.slide-title}

<hr>

[Browse typefaces and fonts at [https://fonts.google.com/](https://fonts.google.com/){target="_blank"}. It can be helpful to type your desired text into the **Preview** field (you may need to expand the sidebar by clicking the **Filters** button on the top left of the page) to get a better sense of how your font choice will look. You can also search typefaces by name.]{.body-text-s}

:::: {.columns}
::: {.column width="50%"}
```{r google-fonts-preview}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "preview-gf-text.png"))
```
::: {.center-text .body-text-s .gray-text}
Previewing [available typefaces](https://fonts.google.com/?preview.text=Water%20availability%20vs.%20consumption){target="_blank"} with our text sample
:::
:::
::: {.column width="50%"}
```{r noto-sans-preview}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "noto-sans-preview.png"))
```
::: {.center-text .body-text-s .gray-text}
Available font styles in the [Noto Sans typeface](https://fonts.google.com/noto/specimen/Noto+Sans?preview.text=Water%20availability%20vs.%20consumption){target="_blank"}
:::
:::
::::

---

## {#our-typefaces data-menu-title="Our typeface choices"} 

[We'll use these three typefaces:]{.slide-title}

<hr>

<br>

:::: {.columns}

::: {.column width="33%"}

::: {.center-text}
**[Sarala](https://fonts.google.com/specimen/Sarala){target="_blank"}**
:::

```{r josefin-sans}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "sarala.png"))
```
:::

::: {.column width="33%"}

::: {.center-text}
**[Noto Sans](https://fonts.google.com/noto/specimen/Noto+Sans){target="_blank"}**
:::

```{r noto-sans}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "noto-sans.png"))
```
:::

::: {.column width="33%"}

::: {.center-text}
**[Red Hat Mono](https://fonts.google.com/specimen/Red+Hat+Mono?query=red+hat+mono){target="_blank"}**
:::

```{r red-hat-mono}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "red-hat-mono.png"))
```
:::

::::

::: {.footer}
**Important:** Pick typefaces that have all the *font styles* (e.g. bold, italic) that you want to use. [Sarala](https://fonts.google.com/specimen/Sarala){target="_blank"} does *not* come in an italic style, meaning we won't be able to render any text in the typeface Sarala and the font style italic. 
:::

---

## {#import-google-fonts data-menu-title="Import Google Fonts"} 

[Import Google Fonts]{.slide-title}

<hr>

[Import `{showtext}` at the top of your script, then use `font_add_google()` to specify the font family(ies) you want to import. **Importantly**, you'll also need to "turn on" showtext using `showtext_auto()` -- this enables showtext font rendering for any newly opened graphics devices.]{.body-text-s} 

```{r import-fonts}
#| eval: true
#| echo: true
#| code-line-numbers: "8,10-18"
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)
library(showtext)

#......................import Google fonts.......................
# `name` is the name of the font as it appears in Google Fonts
# `family` is the user-specified id that you'll use to apply a font in your ggpplot
font_add_google(name = "Sarala", family = "sarala")
font_add_google(name = "Noto Sans", family = "noto-sans")
font_add_google(name = "Red Hat Mono", family = "red")

#................enable {showtext} for rendering.................
showtext_auto()

# ~ additional setup code omitted for brevity ~
```

---

## {#apply-google-fonts-code data-menu-title="Apply Google Fonts (code)"} 

[Apply Google Fonts]{.slide-title}

<hr>

Resulting plot is rendered on the next slide.

<!-- FOR LIVE-CODING (SHOWN ON SLIDE)  -->

```{r apply-fonts-echo}
#| eval: false
#| echo: true
#| code-line-numbers: "22,26,30,33,37"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = "Data Source: USGS CONUS 2025",
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 17,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 12,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 13,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = element_text(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#apply-google-fonts-viz data-menu-title="Apply Google Fonts (viz)"} 

<!-- FOR DISPLAYING PLOT ONLY (NO CODE SHOWN ON SLIDE); ABSOLUTE SIZES CHOSEN BASED ON HOW PLOT RENDERS ON SLIDE   -->

```{r apply-fonts-eval}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = "Data Source: USGS CONUS 2025",
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 22,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = element_text(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#import-fa-fonts data-menu-title="Import Font Awesome fonts"} 

[Import Font Awesome fonts]{.slide-title}

<hr>

[[Font Awesome](https://fontawesome.com/){target="_blank"} is a library of icons, which can be imported and used similar to Google Fonts. You'll need to download the font files first (see today's [pre-class prep instructions](../week7.qmd#pre-class-prep){target="_blank"}). We can then use `showtext::font_add()` to make them available for use in our ggplots:]{.body-text-s}

```{r import-fa}
#| eval: true
#| echo: true
#| code-line-numbers: "16-19"
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(showtext)

#......................import Google Fonts.......................
# `name` is the name of the font as it appears in Google Fonts
# `family` is the user-specified id that you'll use to apply a font in your ggplot
font_add_google(name = "Sarala", family = "sarala")
font_add_google(name = "Noto Sans", family = "noto-sans")
font_add_google(name = "Red Hat Mono", family = "red")

#....................import Font Awesome fonts...................
# we'll only be using an icon from the brands collection today; you'll need to import the other .otf files if you also plan to use icons from those collections
font_add(family = "fa-brands",
         regular = here::here("fonts", "Font Awesome 7 Brands-Regular-400.otf")) 

#......enable {showtext} rendering for all newly opened GDs......
showtext_auto()

# ~ additional setup code omitted for brevity ~
```

## {#fa-unicode data-menu-title="FA Unicode"} 

[Reference icons by their Unicode]{.slide-title}

<hr>

Let's say I want to include my GitHub username along with the GitHub icon in the caption of my plot. Start by searching the [**Free** icons on Font Awesome](https://fontawesome.com/search?ic=free-collection){target="_blank"} and click on the one you want to use (here, the [**github**](https://fontawesome.com/icons/github?f=brands&s=solid){target="_blank"} icon). Find the icon's Unicode in the top right corner of the popup box:

```{r unicode}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "100%"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "fa-unicode.png"))
```

---

## {#create-caption data-menu-title="FA Unicode (caption)"} 

[Add an icon to our caption]{.slide-title}

<hr>

[To use this unicode in HTML, we need to stick a `&#x` ahead of it. We can make our code a bit easier to read by saving the unicode (as well as our username text) to variable names. We'll then use the [`glue::glue()` function](https://glue.tidyverse.org/) to construct our full caption. Importantly, `glue()` will evaluate expressions enclosed by braces as R code.]{.body-text-s}

<br>

```{r create-caption}
#| eval: true
#| echo: true
#.........................create caption.........................
github_icon <- "&#xf09b"
github_username <- "samanthacsik"

caption <- glue::glue(
  "Data Source: USGS CONUS 2025<br>
  <span style='font-family:fa-brands;'>{github_icon};</span>
  {github_username}"
)
```

<br>

[Note that we **(1)** wrap our object names in `{}` to use the values that are saved to them, and **(2)**, we use the HTML `<span>` tag to apply styles to text -- here, we use the `font-family` property and supply it the value, `fa-brands` (which is the id (i.e. `family`) we created when loading the `Font Awesome 7 Brands-Regular-400.otf` file at the top of our script).]{.body-text-s}

---

## {#update-plot-text data-menu-title="Add new plot text"} 

[Apply our new caption]{.slide-title}

<hr>

Resulting plot is rendered on the next slide!

<!-- FOR LIVE-CODING (CODE SHOWN ON SLIDE)  -->

```{r apply-caption-echo}
#| eval: false
#| echo: true
#| code-line-numbers: "17"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 17,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 12,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 13,
                                margin = margin(t = 20)), 
    axis.title.y = element_blank(),
    plot.caption = element_text(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#does-not-work data-menu-title="Doesn't quite work just yet"} 

<!-- FOR DISPLAYING PLOT ONLY (NO CODE SHOWN ON SLIDE); ABSOLUTE SIZES CHOSEN BASED ON HOW PLOT RENDERS ON SLIDE   -->

```{r apply-caption-eval}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus", 
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 22,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = element_text(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#ggplot-HTML-parsing data-menu-title="{ggplot} can't parse HTML"} 

[ggplot doesn't (natively) know how to parse HTML]{.slide-title2}

<hr>

<br>

:::: {.columns}
::: {.column width="50%"}

```{r ggtext-hex}
#| eval: true
#| echo: false
#| out-width: "70%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "ggtext-hex.png"))
```
:::

::: {.column width="50%"}
. . . but the [`{ggtext}` package](https://wilkelab.org/ggtext/){target="_blank"} does! If we want to render ggplot text using HTML or Markdown syntax, **we *also* need to use one of `{ggtext}`'s [`theme()` elements](https://wilkelab.org/ggtext/articles/theme_elements.html){target="_blank"}**, which will parse and render the applied styles. 

<br>

There are a few options, all which replace `{ggplot2}`'s  `element_text()` -- be sure to check out the documentation as you're deciding which to use. We'll use `element_textbox()`.
::: 
::::

---

## {#update-theme-elements-code data-menu-title="Update theme elements (code)"} 

[Update `theme()` element to render styling]{.slide-title}

<hr>

<!-- FOR LIVE-CODING (CODE SHOWN ON SLIDE)  -->

```{r ggtext-caption-echo}
#| eval: false
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
#| code-line-numbers: "37,40,41"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 17,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 12,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 13,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = ggtext::element_textbox(family = "noto-sans",
                                           face = "italic",
                                           color = pal["light_gray"],
                                           halign = 1, 
                                           lineheight = 1.5,
                                           margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

::: {.center-text .body-text-s}
**Note:** Text rendered with `{ggtext}` doesn't typically appear correctly in the plots pane (or when using the Zoom window; see this separate, but potentially related [GitHub issue](https://github.com/wilkelab/ggtext/issues/84){target="_blank"}). For now, you'll want to render your template `.qmd` file to see your plot instead.
:::

---

## {#update-theme-elements-viz data-menu-title="Update theme elements (viz)"} 

<!-- FOR DISPLAYING PLOT ONLY (NO CODE SHOWN ON SLIDE); ABSOLUTE SIZES CHOSEN BASED ON HOW PLOT RENDERS ON SLIDE   -->

```{r ggtext-caption-eval}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = "Water availability vs. consumption across the Santa Barbara\nCoastal subbasin (2010-2020)",
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(family = "sarala",
                              face = "bold",
                              size = 22,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = ggtext::element_textbox(family = "noto-sans",
                                           face = "italic",
                                           color = pal["light_gray"],
                                           halign = 1, 
                                           lineheight = 1.5,
                                           margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#text-legend data-menu-title="Add legend"} 

[We also need to tell readers what our colors mean!]{.slide-title2}

<hr>

[Rather than a traditional legend, let's **color-code our title text (i.e. [availability]{style="color:#448F9C"} & [consumption]{style="color:#9C7344"}) to match the points in our plot**. We can again use the [`{ggtext}` package](https://wilkelab.org/ggtext/){target="_blank"} to apply simple Markdown and HTML rendering to our ggplot text.]{.body-text-s}

. . . 

[We'll need to both **format our title using some HTML**, *and* **update `theme()`** so that this text element is rendered using `ggtext::element_textbox()` (like our caption). Let's construct our title using `glue::glue()`:]{.body-text-s}

```{r create-title}
#| eval: true
#| echo: true
title <- glue::glue("Water
                    <span style='color:#448F9C;'>availability</span> 
                    vs. 
                    <span style='color:#9C7344;'>consumption</span>
                    across the Santa Barbara<br>
                    Coastal subbasin (2010-2020)")
```

. . . 

[Then update to `element_textbox()` and increase the `lineheight` to give the two lines a bit of breathing room:]{.body-text-s}

```{r lineheight}
#| eval: false
#| echo: true
#| code-line-numbers: "1,4"
theme(plot.title = ggtext::element_textbox(family = "sarala",
                                           face = "bold",
                                           size = 16,
                                           lineheight = 1.2,
                                           color = pal["dark_gray"]))
```


::: {.footer}
**Note:** We combine both Markdown syntax (e.g. `**` to **bold text**) and HTML syntax to apply in-line CSS styling (e.g. `<span style=...>`):
:::

---

## {#update-title-element data-menu-title="Update title element"} 

<!-- FOR DISPLAYING PLOT ONLY (NO CODE SHOWN ON SLIDE); ABSOLUTE SIZES CHOSEN BASED ON HOW PLOT RENDERS ON SLIDE   -->

```{r update-title-echo}
#| fig-align: "center"
#| fig-asp: 0.7
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail),
                     alpha = 0.6) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = title,
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = ggtext::element_textbox(family = "sarala",
                                         face = "bold",
                                         size = 22,
                                         lineheight = 1.2,
                                         color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = ggtext::element_textbox(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                halign = 1, 
                                lineheight = 1.5,
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```

---

## {#before-after data-menu-title="Before & After"} 

[Before & after]{.slide-title}

<hr>

<br>

:::: {.columns}

::: {.column width="50%"}
```{r before}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.9
#| out-height: "100%"
# initialize plot (we'll map our aesthetics locally for each geom, below) ----
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = "#448F9C", 
             size = 5,
             stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = "#9C7344", 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(x = "Mean monthly water availability & consumption (mm)") +
  theme(axis.title.y = element_blank())
```

:::

::: {.column width="50%"}
```{r after}
#| eval: true
#| echo: false
#| fig-align: "center"
#| fig-asp: 0.9
#| out-height: "100%"
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
            color = pal["avail"], 
            size = 5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(title = title,
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water availability & consumption (mm)") +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = ggtext::element_textbox(family = "sarala",
                              face = "bold",
                              size = 22,
                              lineheight = 1.2,
                              color = pal["dark_gray"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_gray"],
                                 margin = margin(b = 8)), # you don't need to include arg names, so long as you list margin sizes in order (counterclockwise from top, e.g. `margin(0, 0, 8, 0))
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_gray"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20)),
    axis.title.y = element_blank(),
    plot.caption = ggtext::element_textbox(family = "noto-sans",
                                face = "italic",
                                color = pal["light_gray"],
                                halign = 1, 
                                lineheight = 1.5,
                                margin = margin(t = 15)),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 1, r = 1, b = 1, l = 1, "cm")
  )
```
:::

::::

---

## {#ggsave data-menu-title="ggsave()"} 

[We can use `ggsave()` to save our plot as a PNG file]{.slide-title}

<hr>

`ggsave()` creates a new graphical device to write the output file -- here we specify a PNG device:

```{r ggsave}
#| eval: false
#| echo: true
# write plot to file (aka save as png) ----
ggsave(
  filename = here::here("week7", "images", "sbc-hydro.png"),
  plot = last_plot(), # otherwise, save your plot as an object, and pass the `plot` argument your plot object name
  device = "png",
  width = 8, 
  height = 7,
  unit = "in"
)
```

<br>

We can also turn off showtext rendering for future devices: 

```{r showtext-false}
#| eval: false
#| echo: true
# turn off showtext text rendering ----
showtext_auto(FALSE)
```

---

## {#ggsave-woes data-menu-title="ggsave() woes"} 

[Uh oh . . . ?]{.slide-title}

<hr>

::: {.center-text}
Text elements can cause some annoyances when writing plots to file....You'll learn strategies for fixing this in a future lab!
:::

```{r text-small}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "0-needs-improvement-8x7.png"))
```

---

##  {#break data-menu-title="# Break #" background="#047C90"}

<div class="page-center vertical-center">
<p class="custom-subtitle bottombr">{{< fa mug-hot title="a mug with steam rising out the top" >}} Take a Break</p>
<!-- <p class="caption-text">*~ This is the end of Lesson 1 (of 2) ~*</p> -->
</div>

```{r countdown-end} 
countdown::countdown(
  minutes = 5,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```
