---
format: 
  revealjs:
    slide-number: true
    # code-link: true
    highlight-style: a11y
    chalkboard: true
    theme: 
      - ../../meds-slides-styles.scss
editor_options: 
  chunk_output_type: console
---

## {#title-slide data-menu-title="Title Slide" background="#053660"} 

[EDS 240: Lecture 7.2]{.custom-title}

[*Annotations*]{.custom-subtitle}

<hr class="hr-teal">

[Week 7 | February 18^th^, 2026]{.custom-subtitle3}

---

## {#good-design data-menu-title="Good data viz considerations"} 

[Good data visualization design considers:]{.slide-title}

<hr>

- [**data-ink ratio** (less is more, within reason)]{.gray-text}
- how to **reduce eye movement** and **improve readability / interpretability** (e.g. through alternative legend positions, direct annotations)
- putting things **in context**
- how to **draw the main attention** to the most **important info**
- [**consistent** use of colors, spacing, typefaces, weights]{.gray-text}
- [**typeface / font choices** and how they affect both readability *and* emotions and perceptions]{.gray-text}
- [using **visual hierarchy** to guide the reader]{.gray-text}
- [**color choices** (incl. palette types, emotions, readability)]{.gray-text}
- how to **tell an interesting story**
- [how to **center the people and communities** represented in your data]{.gray-text}
- [**accessibility** through colorblind-friendly palettes & alt text]{.gray-text}

::: {.center-text .teal-text}
**This lesson will focus on the use of annotations in a good data visualization.**
:::

---

<br>

```{r arctic-ice}
#| evaL: true
#| echo: false
#| out-width: "50%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "arctic-ice.png"))
```

::: {.footer}
Source: [Arctic Ice Reaches a
Low Winter Maximum](https://www.nytimes.com/interactive/2015/03/24/science/earth/arctic-ice-low-winter-maximum.html?_r=0){target="_blank"} (New York Times). 

Also check out this great commentary on the above visualization, [Respect your readers' time](https://blog.datawrapper.de/readers-time/){target="_blank"} (DataWrapper).

Enjoy the y-axis units on this data viz? Be sure to check out [The Measure of Things](https://www.themeasureofthings.com/default.php){target="_blank"}, a search engine for comparative measurements.
:::

```{r arctic-ice-countdown}
countdown::countdown(
  minutes = 2,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

:::: {.columns}

::: {.column width="50%"}
```{r daily-records}
#| evaL: true
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "daily-records.png"))
```
:::

::: {.column width="50%"}
```{r ridgeline-hot2023}
#| evaL: true
#| echo: false
#| out-width: "65%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "ridgeline-hot2023.png"))
```
:::

::::

::: {.footer}
Source: [2023 confirmed as world's hottest year on record](https://www.bbc.com/news/science-environment-67861954){target="_blank"} (BBC)
:::

```{r heat-countdown}
countdown::countdown(
  minutes = 2,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

<br>
<br>

:::: {.columns}

::: {.column width="50%"}
```{r global-temp}
#| evaL: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "global-temp-2023diff.png"))
```
:::

::: {.column width="50%"}
```{r global-ocean-temps}
#| evaL: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "global-ocean-temps.png"))
```
:::

::::

::: {.footer}
Source: [2023 confirmed as world's hottest year on record](https://www.bbc.com/news/science-environment-67861954){target="_blank"} (BBC)
:::

```{r temps-countdown}
countdown::countdown(
  minutes = 2,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

```{r co2-levels}
#| evaL: true
#| echo: false
#| out-width: "50%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "co2-levels.png"))
```

::: {.footer}
Source: [What is climate change? A really simple guide](https://www.bbc.com/news/science-environment-24021772){target="_blank"} (BBC)
:::

```{r co2-countdown}
countdown::countdown(
  minutes = 2,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```

---

## {#why-annotate data-menu-title="Why annotate?"} 

[Why annotate?]{.slide-title}

<hr>

. . . 

- [clarify meaning / significance of data (especially particular data points or groups)]{.body-text-s}
- [facilitate interpretation]{.body-text-s}
- [build a narrative]{.body-text-s}

. . . 

The average attention span of an internet user is [~8 seconds](https://www.linkedin.com/pulse/shrinking-attention-span-online-users-what-means-your-avinash-sharma/){target="_blank"} (shorter than a goldfish!). It's imperative that we **respect our readers' time**.

. . . 

<br>

[**Aim to:**]{.body-text-m}

- [tell your readers what you want them to see]{.body-text-s}
- [guide your readers eyes & attention]{.body-text-s}
- [remind your readers what they're looking at]{.body-text-s}

The more time you spend making your visualization crystal clear, **the more time you save your readers needing to decipher it**.

::: {.footer}
Read these two *great* posts: [What to consider when using text in data visualizations](https://blog.datawrapper.de/text-in-data-visualizations/){target="_blank"} & [Respect your readersâ€™ time](https://blog.datawrapper.de/readers-time/){target="_blank"}, both by Lisa Charlotte Muth
:::

---

## {#plots-to-annotate data-menu-title="Annotate these plots"} 

[We'll practice annotating our dumbbell plot]{.slide-title2}

<hr>

```{r original-code}
#| eval: true
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
#| fig-asp: 0.7
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)
library(showtext)
library(glue)
library(ggtext)

#..........................import data...........................
iwa_data <- read_csv(here::here("course-materials", "data", "lecture", "combined_iwa-assessment-outputs-conus-2025_CONUS_200910-202009_long.csv"))

#..................create df of subregions names.................
# data only contain HUC codes; must manually join names if we want to include those in our viz (which we do! we'll mainly be looking at CA subregions)
# subregions (& others) identified in: https://water.usgs.gov/GIS/wbd_huc8.pdf
# there may be a downloadable dataset containing HUCs & names out there...but I couldn't find it
subregion_names <- tribble(
  ~subregion_HUC, ~subregion_name,
  "1801", "Klamath-Northern California Coastal",
  "1802", "Sacramento",
  "1803", "Tulare-Buena Vista Lakes",
  "1804", "San Joaquin",
  "1805", "San Francisco Bay",
  "1806", "Central California Coastal",
  "1807", "Southern California Coastal",
  "1808", "North Lahontan", 
  "1809", "Northern Mojave-Mono Lake",
  "1810", "Southern Mojave-Salton Sea",
)

#......................import Google fonts.......................
# `name` is the name of the font as it appears in Google Fonts
# `family` is the user-specified id that you'll use to apply a font in your ggplot
font_add_google(name = "Sarala", family = "sarala")
font_add_google(name = "Noto Sans", family = "noto-sans")
font_add_google(name = "Red Hat Mono", family = "red")

#....................import Font Awesome fonts...................
font_add(family = "fa-brands",
         regular = here::here("fonts", "Font Awesome 7 Brands-Regular-400.otf"))
font_add(family = "fa-regular",
         regular = here::here("fonts", "Font Awesome 7 Free-Regular-400.otf")) 
font_add(family = "fa-solid",
         regular = here::here("fonts", "Font Awesome 7 Free-Solid-900.otf"))

#......enable {showtext} rendering for all newly opened GDs......
showtext_auto()

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                wrangle data                              ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#......create df with just CA water resource region (HUC 18).....
ca_region <- iwa_data |> 
  clean_names() |> 
  mutate(region_HUC = str_sub(string = huc12_id, start = 1, end = 2),
         subregion_HUC = str_sub(string = huc12_id, start = 1, end = 4)) |> 
  filter(region_HUC == "18") |> 
  separate_wider_delim(cols = year_month,
                       delim = "-",
                       names = c("year", "month")) |>                            
  mutate(year = as.numeric(year),
         month = as.numeric(month)) |> 
  left_join(subregion_names) |> 
  select(year, month, huc12_id, region_HUC, subregion_HUC, subregion_name, availab_mm_mo, consum_mm_mo, sui_frac)

#.................create df of just SBC subbasin.................
sbc_subbasin_monthly <- ca_region |> 
  mutate(subbasin_HUC = str_sub(string = huc12_id, start = 1, end = 8)) |> 
  filter(subbasin_HUC == "18060013") |> #
  group_by(month) |> 
  summarize(mean_avail = mean(availab_mm_mo, na.rm = TRUE),
            mean_consum = mean(consum_mm_mo, na.rm = TRUE)) |> 
  mutate(month = month.abb[month],
         month = factor(month, levels = rev(c(month.abb[10:12], month.abb[1:9]))))

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                 build plot                               ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#......................create color palette......................
pal <- c("avail" = "#448F9C",
         "consum" = "#9C7344",
         "dark_text" = "#0C1509",
         "light_text" = "#4E514D") 

#..........................create title..........................
title <- glue::glue("Water
                    <span style='color:#448F9C;'>supply</span> 
                    vs. 
                    <span style='color:#9C7344;'>demand</span>
                    across the Santa Barbara Coastal<br>
                    subbasin (2010-2020)")

#.........................create caption.........................
github_icon <- "&#xf09b"
github_username <- "samanthacsik"

caption <- glue::glue(
  "Data Source: USGS CONUS 2025<br>
  <span style='font-family:fa-brands;'>{github_icon};</span>
  {github_username}"
)

#..........................updated plot..........................
water_plot <- ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = pal["avail"], 
             size = 5.5,
            stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = pal["consum"], 
             fill = "white",
             shape = 21,
             stroke = 2,
             size = 5.5) +
  labs(title = title,
       subtitle = "Summer deficits exist, despite winter water surplus",
       caption = caption,
       x = "Mean monthly water supply & demand (mm)") +
  theme_minimal() +
  theme(
    plot.title.position = "plot",
    plot.title = ggtext::element_textbox(family = "sarala",
                                         face = "bold",
                                         size = 22,
                                         lineheight = 1.2,
                                         color = pal["dark_text"]),
    plot.subtitle = element_text(family = "noto-sans",
                                 size = 16,
                                 color = pal["light_text"],
                                 margin = margin(t = 3, r = 0, b = 8, l = 0)),
    axis.text = element_text(family = "red",
                             size = 13,
                             color = pal["light_text"]),
    axis.title.x = element_text(family = "noto-sans",
                                size = 14,
                                margin = margin(t = 20, r = 0, b = 0, l = 0)),
    axis.title.y = element_blank(),
    plot.caption = ggtext::element_textbox(family = "noto-sans",
                                           face = "italic",
                                           color = pal["light_text"],
                                           halign = 1, 
                                           lineheight = 1.5,
                                           margin = margin(t = 15, r = 0, b = 0, l = 0)),
    plot.margin = margin(t = 1, r = 1, b = 0.5, l = 1, "cm")
  )

water_plot
```


---

## {#build-custom-annotations data-menu-title="How to build custom annotations"} 

[Building custom annotations]{.slide-title}

<hr>

<br>

[There are two primary ways to add custom text annotations:]{.body-text-m}

. . . 

<br>

1. `geom_text()` (for plain text) & `geom_label()` (adds a rectangle behind text), which take aesthetics mappings; these draw the geom *once per each row of the data frame*
2. `annotate()`, which does not take aesthetics mappings and instead draws only the information provided to it 

. . . 

<br>

[Let's try to add an annotation to our plot using both approaches to better understand the difference.]{.body-text-m}

. . . 

<br>
 
::: {.center-text}
[**Our goal:**]{.teal-text} add a rectangle that bounds / highlights just the summer months, add text nearby that reads **summer water deficit**, and draw an arrow from the text pointing to the box.
:::

::: {.footer}
I've found the [Annotation FAQ](https://ggplot2.tidyverse.org/articles/faq-annotation.html){target="_blank"} super helpful!
:::

---

## {#geom-text-issues data-menu-title="geom_text() doesn't work"} 

[`geom_text()` + `geom_rect()` doesn't look right .  . .]{.slide-title2}

<hr>

Here, we use `geom_text()` + `geom_rect()` to add text and a rectangle to our plot. We need to **supply coordinates** to place each on our plot.

```{r practice-geom-text-rect}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| output-location: column
water_plot + 
    geom_text(
        x = 10,
        y = 3,
        label = "summer & early fall months experience\nthe largest water deficits",
        size = 5,
        color = "black",
        hjust = "center",
    ) +
    geom_rect(
        xmin = -1, xmax = 2.5,
        ymin = 0.5, ymax = 4.5,
        fill = "gray40", color = "black",
        show.legend = FALSE
    )
```

[Notice that our text looks oddly blurry and bold, and our rectangle is opaque (despite adjusting `alpha`) and has a weird, thick border.]{.body-text-s}

---

## {#geom-text-aes data-menu-title="geom_text() inherits aesthetics"} 

[`geom_text()` inherits aesthetic mappings from `ggplot()`]{.slide-title3}

<hr>

[Like all other `geom_*()` functions we've worked with, **`geom_text()` (and related geoms) take aesthetic mappings**. You can either define `aes()` within the geom, *or* it'll inherit global mappings from `ggplot()` (as in our case).]{.body-text-s}

<br>

. . . 

[Here, `geom_text()` is plotting our label (**water deficit**) and box 12 times each (once for each of the 12 observations in our data frame).]{.body-text-s}

```{r}
#| eval: true
#| echo: true
str(sbc_subbasin_monthly)
```

<!-- . . . 

[It's also inheriting the `size` aesthetic for our box border.]{.body-text-s} -->

```{r}
#| eval: false
#| echo: false
# from our `lob_plot` code
# scale_size_manual(values = lob_sizes) 
```

---

## {#use-annotate data-menu-title="Use annotate()"} 

[This is exactly the situation `annotate()` was made for]{.slide-title3}

<hr>

[Alternatively, `annotate()` requires that we define a `geom` type (e.g. `"text"`, `"rect"`). We'll also omit the `show.lengend` argument, since `annotate()` doesn't produce a legend.]{.body-text-s}

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| output-location: column
water_plot + 
    annotate(
        geom = "text",
        x = 10,
        y = 3,
        label = "summer & early fall months experience\nthe largest water deficits",
        size = 5,
        color = "black",
        hjust = "center",
        family = "noto-sans"
    ) +
    annotate(
        geom = "rect",
        xmin = -1, xmax = 2.5,
        ymin = 0.5, ymax = 4.5,
        fill = "gray70", color = "gray70", alpha = 0.5
    )
```

[**Note:** Determining coordinates for any annotation requires a lot of trial and error. Pick values that you think are close and then tweak from there.]{.body-text-s}

---

## {#draw-arrow data-menu-title="Draw arrow"} 

[Draw an arrow between our label and rectangle]{.slide-title2}

<hr>

[We can specify the `"curve"` geom type to draw a curved line. Use the `arrow` argument + `arrow()` function to add an arrow tip on the end:]{.body-text-s}

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| code-line-numbers: "17-23"
#| output-location: column
water_plot + 
    annotate(
        geom = "text",
        x = 10,
        y = 3,
        label = "Santa Barbara maintains a diverse water supply portfolio (e.g groudwater, recycled water, and desalination) to draw from when consumption outpaces natural supply", 
        size = 5,
        color = "black",
        hjust = "center",
        family = "noto-sans"
    ) +
    annotate(
        geom = "rect",
        xmin = -1, xmax = 2.5,
        ymin = 0.5, ymax = 4.5,
        fill = "gray70", color = "gray70", alpha = 0.5
    ) +
    annotate(
        geom = "curve",
        x = 7, xend = 2.6,
        y = 2.7, yend = 2,
        curvature = -0.25,
        arrow = arrow(length = unit(0.3, "cm"))
    )
```

---

## {#use-geoms data-menu-title="Using geom_text() & geom_label()"} 

[Use `geom_text/label()` to annotate each point]{.slide-title2}

<hr>

:::: {.columns}

::: {.column width="50%"}
::: {.center-text .body-text-s .gray-text}
`geom_text()` adds plain text
:::

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
water_plot +
  geom_text(aes(x = mean_avail, y = month, label = round(mean_avail, 2)),
            size = 6,
            show.legend = FALSE)
```
:::

::: {.column width="50%"}
::: {.center-text .body-text-s .gray-text}
`geom_label()` adds a rectangle behind text
:::

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
water_plot +
  geom_label(aes(x = mean_avail, y = month, label = round(mean_avail, 2)),
             size = 6,
             show.legend = FALSE)
```
:::
::::

::: {.center-text}
Annotations sit on top of data points, which may be undesirable...
:::

---

## {#use-ggrepel data-menu-title="{ggrepel}"} 

[Use `{ggrepel}` to repel annotations]{.slide-title}

<hr>

:::: {.columns}

::: {.column width="50%"}
::: {.center-text .body-text-s .gray-text}
`geom_text()` adds plain text
:::

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
water_plot +
  ggrepel::geom_text_repel(aes(x = mean_avail, y = month, label = round(mean_avail, 2)),
                           size = 7,
                           color = "gray10",
                           nudge_x = 0.2, nudge_y = 0.4,
                           arrow = arrow(length = unit(0.25, "cm")))
```
:::

::: {.column width="50%"}
::: {.center-text .body-text-s .gray-text}
`geom_label()` adds a rectangle behind text
:::

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
water_plot +
  ggrepel::geom_label_repel(aes(x = mean_avail, y = month, label = round(mean_avail, 2)),
                           size = 4,
                           color = "gray10",
                           nudge_x = 0.1, nudge_y = 0.3,
                           arrow = arrow(length = unit(0.25, "cm")))
```
:::
::::

---

## {#manually-label-iv10 data-menu-title="Manually label points (IV10)"} 

[Manually label just a few important points]{.slide-title}

<hr>

If we have just a few months that we want to call attention to, we can use `annotate()` to label them. Let's start with Feb:

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| output-location: column
water_plot +
  annotate(
    geom = "text",
    x = 17, y = 9.5,
    label = "February has the highest\naverage water supply",
    hjust = "center",
    size = 4.5
    ) +
  annotate(
    geom = "curve",
    x = 19.6, xend = 20.4,
    y = 9.4, yend = 8.6,
    curvature = -0.25,
    arrow = arrow(length = unit(0.3, "cm")),
    linewidth = 0.6
    ) 
```

---

## {#mono-plot data-menu-title="Mono Lake plot"} 

[Mono Lake plot starter code]{.slide-title}

<hr>

```{r mono-starter-code}
#| eval: true
#| echo: true
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#.........................load libraries.........................
library(tidyverse)

#..........................read in data..........................

# read in Google Sheet ----
mono <- googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/1o0-89RFp2rI2y8hMQWy-kquf_VIzidmhmVDXQ02JjCA/edit#gid=164128885")

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                            create Mono Lake plot                         ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ggplot(data = mono, aes(x = year, y = lake_level)) +
  geom_line() +
  labs(x = "\nYear",
       y = "Lake surface level\n(feet above sea level)\n",
       title = "Mono Lake levels (1850 - 2017)\n",
       caption = "Data: Mono Basin Clearinghouse") +
  scale_x_continuous(limits = c(1850, 2020),
                     expand = c(0,0),
                     breaks = seq(1850, 2010, by = 20)) +
  scale_y_continuous(limits = c(6350, 6440),
                     breaks = c(6370, 6400, 6430),
                     expand = c(0,0),
                     labels = scales::label_comma()) +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(size = 16),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    plot.caption = element_text(face = "italic")
    )
```

---

## {#highlight-years data-menu-title="Highlight years"} 

[Highlight years of interest]{.slide-title}

<hr>

[Let's say we want to call particular attention to the **sharp decline in lake surface level between 1941 - 1983** as a result of [unrestricted water diversions](https://www.monolake.org/learn/aboutmonolake/savingmonolake/#:~:text=In%201941%2C%20the%20Los%20Angeles,volume%2C%20and%20doubled%20in%20salinity.){target="_blank"}. Let's do so using `annotate()` (**note** the order of our annotation layers matters!).]{.body-text-s}

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| code-line-numbers: "2-13"
#| output-location: column
ggplot(data = mono, aes(x = year, y = lake_level)) +
  annotate(
    geom = "rect",
    xmin = 1941, xmax = 1983,
    ymin = 6350, ymax = 6440,
    fill = "gray90"
  ) +
  annotate(
    geom = "text", 
    x = 1962, y = 6425,
    label = "unrestricted diversions\n(1941 - 1983)",
    size = 3
  ) +
  geom_line() +
  labs(x = "\nYear",
       y = "Lake surface level\n(feet above sea level)\n",
       title = "Mono Lake levels (1850 - 2017)\n",
       caption = "Data: Mono Basin Clearinghouse") +
  scale_x_continuous(limits = c(1850, 2020),
                     expand = c(0,0),
                     breaks = seq(1850, 2010, by = 20)) +
  scale_y_continuous(limits = c(6350, 6440),
                     breaks = c(6370, 6400, 6430),
                     expand = c(0,0),
                     labels = scales::label_comma()) +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(size = 16),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    plot.caption = element_text(face = "italic")
    )
```

<!-- [Note the importance of *order* here! Plotting our `geom_line()` layer *after* creating our gray rectangle ensures that it isn't blocked.]{.body-text-s} -->

::: {.notes}
- Mono Lake is an ancient saline lake that sits at the edge of the Great Basin and Sierra Nevada mountains and covers >70 square miles.
- Supports a highly productive ecosystem
- No fish, but trillions of brine shrimp and alkali flies, which sustain millions of migratory birds a year
- In 1941, the LA Department of Water & Power began diverting water from the streams that feed Mono Lake to meet growing demand in LA
- Over 40 years, Mono Lake dropped 45 vertical feet, lost half it's volume of water, and doubled in salinity
- Nesting sites were compromised, and air quality degraded from the exposed lake bed dust
- Grassroots efforts to save Mono Lake began in 1976, led by UC Davis & Stanford students (eventually becoming the Mono Lake Committee)
- In 1983, the CA Supreme Court sided with Mono Lake Committee and ruled that the state had an obligation to protect places like Mono Lake "as far as feasible"


:::

---

## {#add-context data-menu-title="Add context"} 

[Add other important context]{.slide-title}

<hr>

[[Mono Lake's brine shrimp](https://www.monolake.org/learn/aboutmonolake/naturalhistory/brineshrimp/#:~:text=Within%20Mono%20Lake's%20briny%20waters,during%20the%20warmer%20summer%20months.){target="_blank"} provide food for millions of migratory birds. Abundances are expected to decline if water levels drop below 6,360 feet above sea level. We can provide context by adding a benchmark line and text.]{.body-text-s}

```{r}
#| eval: true
#| echo: true
#| fig-align: "center"
#| fig-asp: 0.7
#| code-line-numbers: "26-33"
#| output-location: column
ggplot(data = mono, aes(x = year, y = lake_level)) +
  annotate(
    geom = "rect",
    xmin = 1941, xmax = 1983,
    ymin = 6350, ymax = 6440,
    fill = "gray90"
  ) +
  annotate(
    geom = "text", 
    x = 1962, y = 6425,
    label = "unrestricted diversions\n(1941 - 1983)",
    size = 3
  ) +
  geom_line() +
  labs(x = "\nYear",
       y = "Lake surface level\n(feet above sea level)\n",
       title = "Mono Lake levels (1850 - 2017)\n",
       caption = "Data: Mono Basin Clearinghouse") +
  scale_x_continuous(limits = c(1850, 2020),
                     expand = c(0,0),
                     breaks = seq(1850, 2010, by = 20)) +
  scale_y_continuous(limits = c(6350, 6440),
                     breaks = c(6370, 6400, 6430),
                     expand = c(0,0),
                     labels = scales::label_comma()) +
  geom_hline(yintercept = 6360, 
             linetype = "dashed") +
  annotate(
    geom = "text",
    x = 1900, y = 6366,
    label = "Decreased brine shrimp abundance expected\n(6,360 feet above sea level)",
    size = 3
    ) +
  theme_light() +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(size = 16),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    plot.caption = element_text(face = "italic")
    )
```

---

## {#additional-tools data-menu-title="More tools"} 

[Keep these additional tips, tools & tutorials in mind!]{.slide-title2}

<hr>

[**Tools & packages:**]{.body-text-m}

- [use `clip = "off"` inside a `coord_*()` function to allow drawing outside the plot panel (see [this tweet](https://twitter.com/ClausWilke/status/991542952802619392){target="_blank"} for one example)]{.body-text-s}

- [the [`{ggfittext}` package](https://wilkox.org/ggfittext/){target="_blank"} is a ggplot2 extension for fitting text into boxes]{.body-text-s}

- [the [`{ggtext}` package](https://wilkelab.org/ggtext/index.html){target="_blank"} includes two geoms for annotating plots, `geom_richtext()` & `geom_textbox()` -- both permit Markdown styling]{.body-text-s}

- [the [`{ggforce}` package](https://ggforce.data-imaginist.com/){target="_blank"} has *so* many awesome functions, including a series of [annotation functions](https://ggforce.data-imaginist.com/reference/index.html#annotation){target="_blank"} (e.g. check out [`geom_mark_ellipse()`](https://ggforce.data-imaginist.com/reference/geom_mark_ellipse.html){target="_blank"}, demoed in the [what makes a good viz? slides](SLIDES-good-viz.qmd#ggforce){target="_blank"}), and [`facet_zoom()`](https://ggforce.data-imaginist.com/reference/facet_zoom.html){target="_blank"}, for zooming into a subset of data; [Tuo Wang](https://tuowang.rbind.io/){target="_blank"} also has some great examples in [this blog post](https://tuowang.rbind.io/blog/ggplot2-extensions/02-ggplot2-extensions/#3-span-stylecolor-coralggforcespan-package){target="_blank"}]{.body-text-s}

[**Tutorials:**]{.body-text-m}

- [[Level Up Your Labels: Tips and Tricks for Annotating Plots](https://www.cararthompson.com/talks/user2022/){target="_blank"}, by [Cara Thompson](https://www.cararthompson.com/){target="_blank"}]{.body-text-s}

- [[Recreating the Storytelling with Data look with ggplot](https://albert-rapp.de/posts/ggplot2-tips/10_recreating_swd_look/10_recreating_swd_look.html#add-text-labels){target="_blank"}, by [Albert Rapp](https://albert-rapp.de/){target="_blank"}]{.body-text-s}

- [[4 Ways to use colors in ggplot more efficiently](https://albert-rapp.de/posts/ggplot2-tips/07_four_ways_colors_more_efficiently/07_four_ways_colors_more_efficiently#label-directly){target="_blank"}, by [Albert Rapp](https://albert-rapp.de/){target="_blank"} (includes some great annotation examples)]{.body-text-s}

---

##  {#break data-menu-title="# Break #" background="#047C90"}

<div class="page-center vertical-center">
<p class="custom-subtitle bottombr">{{< fa mug-hot title="a mug with steam rising out the top" >}} Take a Break</p>
<!-- <p class="caption-text">*~ This is the end of Lesson 1 (of 2) ~*</p> -->
</div>

```{r countdown-end} 
countdown::countdown(
  minutes = 5,
  # left = 0, right = 0,
  # Fanfare when it's over
  play_sound = TRUE,
  color_border              = "#FFFFFF",
  color_text                = "#7aa81e",
  color_running_background  = "#7aa81e",
  color_running_text        = "#FFFFFF",
  color_finished_background = "#ffa07a",
  color_finished_text       = "#FFFFFF",
  font_size = "2em",
  )
```
