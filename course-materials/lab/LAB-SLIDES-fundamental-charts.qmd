---
format: 
  revealjs:
    slide-number: true
    # code-link: true
    highlight-style: a11y
    chalkboard: true
    theme: 
      - ../../meds-slides-styles.scss
editor_options: 
  chunk_output_type: console
---

## {#title-slide data-menu-title="Title Slide" background="#047C91"} 

[EDS 240: Lab 4]{.custom-title}

[*Fundamental chart types in review*]{.custom-subtitle}

<hr class="hr-dark-blue">

[Week 4 | January 29^th^, 2026]{.custom-subtitle3}

---

## {#fundamental-charts data-menu-title="Fundamental charts"}
[Choosing the Right Chart for Your Story]{.slide-title2}
<hr>

[Over the past four weeks, we've built a toolkit of fundamental chart typesâ€”each designed to highlight different patterns, relationships, and insights in your data.]{.body-text-m}

. . .

[**Today's Goals:**]{.body-text-m}

[- Select the most effective chart type for your data and message]{.body-text-m}

[- Apply design principles to create clear, compelling visualizations]{.body-text-m}

. . .

[Let's review the charts in our toolkit and when to use each one!]{.body-text-m .teal-text}

---

## {#distributions data-menu-title="Distributions"}

[**Distributions**]{.slide-title}
```{r load-pkgs}
#| eval: true
#| echo: false
library(palmerpenguins)
library(tidyverse)
library(ggridges)
library(ggbeeswarm)
```

:::: columns

::: {.column width="33%"}
::: {.center-text}
**Histograms**
:::
```{r penguin-histogram}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, fill = species)) +
  geom_histogram(alpha = 0.5, position = "identity")
```
:::

::: {.column width="33%"}
::: {.center-text}
**Density plots**
:::
```{r penguin-density}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, fill = species)) +
  geom_density(alpha = 0.5)
```
:::

::: {.column width="33%"}
::: {.center-text}
**Ridgeline plots**
:::
```{r penguin-ridgeline}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  ggridges::geom_density_ridges(alpha = 0.5)
```
:::

::::

:::: columns

::: {.column width="50%"}
::: {.center-text}
**Box plots**
:::
```{r penguin-box}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "65%"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  geom_boxplot(alpha = 0.5)
```
:::

::: {.column width="50%"}
::: {.center-text}
**Violin plots**
:::
```{r penguin-violin}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "65%"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  geom_violin(alpha = 0.5)
```
:::

::::

::: {.footer}
[Examples show the distribution of penguin body masses (g) for Adelie, Chinstrap & Gentoo penguins.]{.body-text-s .gray-text} 
:::

---

## {#distributions data-menu-title="Distribution considerations"}

[**Distribution Considerations**]{.slide-title}

- Use when you have a lot of values with meaningful differences between those values 
- Avoid plotting too many groups at once
- Consider faceting
- Consider plotting fewer groups
- Modify bin/ bandwidths 
- Overlay histogram & density plots as a sanity check 
- If you have too many groups, consider: a ridgline plot, a box plot, or a violin plot!

---

## {#rankings data-menu-title="Rankings"}

[**Rankings**]{.slide-title}
```{r}
#| eval: true
#| echo: false

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)
library(scales)

#..........................import data...........................
iwa_data <- read_csv(here::here("course-materials", "data", "lecture", "combined_iwa-assessment-outputs-conus-2025_CONUS_200910-202009_long.csv"))

#..................create df of subregions names.................
# data only contain HUC codes; must manually join names if we want to include those in our viz (which we do! we'll mainly be looking at CA subregions)
# subregions (& others) identified in: https://water.usgs.gov/GIS/wbd_huc8.pdf
# there may be a downloadable dataset containing HUCs & names out there...but I couldn't find it
subregion_names <- tribble(
  ~subregion_HUC, ~subregion_name,
  "1801", "Klamath-Northern California Coastal",
  "1802", "Sacramento",
  "1803", "Tulare-Buena Vista Lakes",
  "1804", "San Joaquin",
  "1805", "San Francisco Bay",
  "1806", "Central California Coastal",
  "1807", "Southern California Coastal",
  "1808", "North Lahontan", 
  "1809", "Northern Mojave-Mono Lake",
  "1810", "Southern Mojave-Salton Sea",
)

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                wrangle data                              ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#......create df with just CA water resource region (HUC 18).....
ca_region <- iwa_data |> 

  # make nicer column names ----
  clean_names() |> 

  # create columns for 2-unit (region-level) & 4-unit (subregion-level) HUC using full 12-unit HUC ----
  mutate(region_HUC = str_sub(string = huc12_id, start = 1, end = 2),
         subregion_HUC = str_sub(string = huc12_id, start = 1, end = 4)) |> 
  
  # filter for just CA region (HUC 18) ----
  filter(region_HUC == "18") |> 

  # separate year and month into two columns ----
  separate_wider_delim(cols = year_month,
                       delim = "-",
                       names = c("year", "month")) |> 

  # convert year and month from chr to num ---                            
  mutate(year = as.numeric(year),
         month = as.numeric(month)) |> 
  
  # join subregion names ----
  left_join(subregion_names) |> 
  
  # keep necessary columns & reorder in more logical way -----
  select(year, month, huc12_id, region_HUC, subregion_HUC, subregion_name, availab_mm_mo, consum_mm_mo, sui_frac)

# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# ##                            explore missing data                          ----
# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# sub1805 <- ca_region |> 
#   filter(subregion_HUC == "1805") 

# see_NAs <- ca_region |> 
#   group_by(year) |> 
#   naniar::miss_var_summary() |>
#   filter(variable == "availab_mm_mo")

# avail <- sub1805 |> select(availab_mm_mo)
# missing_avail <- naniar::vis_miss(avail)
```

:::: columns

::: {.column width="33%"}
::: {.center-text}
**Bar Plots**
:::
```{r}
#| eval: true
#| echo: false
#| fig-align: "center"
ca_region |> 
  group_by(subregion_name) |> 
  summarise(mean_sui_2010_2020 = mean(sui_frac, na.rm = TRUE)) |> 
  ggplot(aes(x = subregion_name, y = mean_sui_2010_2020)) +
  geom_col() 
```
:::

::: {.column width="33%"}
::: {.center-text}
**Lollipop Plots**
:::
```{r basic-lollipop}
#| eval: true
#| echo: false
#| fig-align: "center"
ca_region |> 
  group_by(subregion_name) |> 
  summarise(mean_sui_2010_2020 = mean(sui_frac, na.rm = TRUE)) |> 
  ggplot(aes(x = subregion_name, y = mean_sui_2010_2020)) +
  geom_point() +
  geom_linerange(aes(ymin = 0, ymax = mean_sui_2010_2020))
```
:::

::: {.column width="33%"}
::: {.center-text}
**Dumbbell Plots**
:::
```{r dumbbell-example}
#| eval: true
#| echo: false
#| out-width: "70%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "dumbbell-example.png"))
```
:::

::::


[Considerations:]{.body-text-m} 

- Make space for long x axis labels (`coord_flip`)
- Reordering groups helps readers to draw quicker insights
- Add direct labels if the exact values are important



---

## {#evolution data-menu-title="Evolution"}

[**Evolution**]{.slide-title}

:::: columns

```{r data-wrangling}
#| eval: true
#| echo: false
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#.........................load libraries.........................
library(tidycensus)
library(tidyverse)
library(gghighlight)
library(scales)

#..........................import data...........................
lyme <- read_csv(here::here("course-materials", "data", "lecture",  "2023_CaseIncid-Lyme-Disease-Cases-by-State-or-Locality.csv"))

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                          wrangle lyme disease data                       ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#............wide to long (plus some other wrangling)............
lyme_clean <- lyme |> 
  
  rename(state = State) |> 
  
  # remove special character from State names that have it ----
  mutate(state = str_replace(string = state, pattern = "\x86", replacement = "")) |> 
  
  # remove total cases row ----
  filter(state != "U.S. Total") |> 
  
  # wide to long (tidy) years ----
  pivot_longer(cols = 2:17, names_to = "year", values_to = "reported_cases") |> 
  
  # reorder columns ----
  relocate(year, state, reported_cases) |> 
  
  # filter for years 2010 - 2020 ----
  filter(year %in% c(2010:2020))
  
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                          get & wrangle census data                       ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# NOTE: {tidycensus} functions (e.g. `get_estimates()`) internally call `Sys.getenv("CENSUS_API_KEY)` to retrieve your key from `.Renviron` 
# Meaning you don't need to explicitly call `Sys.getenv("CENSUS_API_KEY)` in your code -- `{tidycensus}` handles that for you!

#...................get pop estimates by state...................
us_state_pop <- get_estimates(geography = "state", 
                              product = "population",
                              state = NULL, 
                              year = 2019) |> # request 2019 vintage for the 2010s (see documentation)
  filter(variable == "POP") |> 
  select(state = NAME, population = value) |> 
  filter(state != "Puerto Rico")

#........................write data to csv.......................
# OPTIONAL, but recommended in case you want to work offline, the API is down, etc. 
# (if so, you can then read in your saved data file rather than run the above code)
# write_csv(us_state_pop, file = here::here("week3", "data", "us_state_pop_2019vintage.csv"))  

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                            join lyme & pop dfs                           ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

lyme_pop <- left_join(lyme_clean, us_state_pop) |>  
  
  # add col with num of 100k people per state ----
  mutate(pop100k = population/100000) |> 
  
  # calculate num cases per 100k people (common way of reporting disease incidence) ----
  mutate(cases_per100k = reported_cases/pop100k) 
```





::: {.column width="33%"}
::: {.center-text}
**Line Charts**
:::
```{r line-point}
#| eval: true
#| echo: false
ggplot(lyme_pop, aes(x = year, y = cases_per100k, group = state)) + 
  geom_line() +
  geom_point()
```
:::

::: {.column width="33%"}
::: {.center-text}
**Area plots**
:::
```{r}
#| eval: true
#| echo: false
lyme_pop |> 
  filter(state == "New Jersey") |> 
  ggplot(aes(x = year, y = cases_per100k, group = state, fill = state)) +
  geom_area() +
  scale_fill_manual(values = c("#047C90")) +
  scale_x_discrete(expand = c(0, NA)) +
  scale_y_continuous(expand = c(0, NA)) +
  theme(legend.position = "none")
```
:::



::: {.column width="33%"}
::: {.center-text}
**Stacked area plots**
:::

```{r}
#| eval: true
#| echo: false
lyme_pop |> 
  filter(state %in% c("Maine", "Rhode Island", "New Hampshire", "Vermont")) |> 
  ggplot(aes(x = year, y = cases_per100k, group = state, fill = state)) +
  geom_area()
```
:::

::::

:::: columns


::: {.column width="33%"}
::: {.left-text}
- Too many lines can be hard to read 
- Highlight important trends using `gghighlight()`
- Manipulating the aspect ration can be deceptive! Tread carefully!
:::
:::



::: {.column width="33%"}
::: {.left-text}
- If number of observations is low, a connected scatter plot might be a better fit! 
:::
:::



::: {.column width="33%"}
::: {.left-text}
- Group order matters!
- Not meant for studying the evolution of individual groups

:::
:::






::::




---

## {#relationships data-menu-title="Numeric Relationships"}

[**Numeric Relationships**]{.slide-title}



```{r metajam-echo}
#| eval: true
#| echo: false
#..........................load packages.........................
library(metajam) 
library(tidyverse)
library(ggExtra)
library(ggdensity)
library(dplyr)

#........................get the data file.......................
stream_chem_data <- read_csv(here::here("course-materials", "data", "lecture", "https_pasta_lternet_edu_package_metadata_eml_knb-lter-hbr_208_14__HubbardBrook_weekly_stream_chemistry_1963-2025__csv",  "HubbardBrook_weekly_stream_chemistry_1963-2025.csv"))
```

::::columns


::: {.column width="50%"}
::: {.center-text}
**Scatter Plots**
:::

```{r basic-scatter}
#| eval: true
#| echo: false

stream_chem_data %>% 
  filter(waterYr == 2024) %>%  
  ggplot(aes(x = DOC, y = pH)) + 
  geom_point(alpha = 0.5)
```
:::


::: {.column width="50%"}
::: {.center-text}
**2D density plots**
:::

```{r 2d-density}
ggplot(stream_chem_data, aes(x = SO4, y = pH)) +
  geom_density_2d_filled()
```
:::

::::


:::: columns


::: {.column width="50%"}
::: {.left-text}
[- The `{ggExtra}` can be used to add marginal histograms/ boxplots/ density plots to ggplot scatter plots]{.body-text-s}

[- If suitable, you can add a trend line or line of best fit using `geom_smooth()`]{.body-text-s}

[- You can add in a third numeric variable by creating a bubble chart or using color (Use caution and address these [challenges]( https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLIDES-relationships.html#/third-var-difficult))]{.body-text-s}

[- Overplotting can disguise trends]{.body-text-s} 

:::
:::



::: {.column width="50%"}
::: {.left-text}
[- The `{ggdensity}` provides alternative functions for contour lines and filled contours]{.body-text-s} 
:::
:::



::::

## {#tips data-menu-title="Tips for choosing a graph"}

[Tips for choosing the right graphic form]{.slide-title}

<hr>

. . .

1. [**Think about the task(s) you want to enable or message(s) you want to convey.**]{.teal-text} For example, do you want to compare, see change or flow, reveal relationships or connections, envision temporal or spatial patterns, show big picture trends or allow for comparisons of individual values.

. . .

2. [**Consider the number of variables and the number of data points, as well as the data types you're working with.**]{.teal-text} For example, do you have several vs. many data points? How many categorical and/or numeric variables? Are your variables ordered or not ordered? Data types can dictate which graphical form is appropriate.

. . .

3. [**Try multiple different graphic forms,**]{.teal-text} especially if you have more than one task to enable or message to convey.

. . .

4. [**Arrange the components of the graphic**]{.teal-text} to make it as easy as possible to extract meaning from your graphic quickly.

. . .

5. [**Test the outcomes of your graphic on others,**]{.teal-text} particularly on those who are representative of the audience you are trying to reach.

::: footer
[*Most of the above tips are adapted from [Alberto Cairo's](https://www.albertocairo.com/){target="_blank"} [The Truthful Art](https://www.amazon.com/gp/product/0321934075/ref=as_li_qf_sp_asin_il_tl?camp=1789&creative=9325&creativeASIN=0321934075&ie=UTF8&linkCode=as2&linkId=A7BVNPNHHPEPJU7K&tag=thefunart03-20){target="_blank"}*]{.gray-text .body-text-s}
:::

---


## {#data-to-viz data-menu-title="Data to Viz Resource"}
[From Data to Viz]{.slide-title2}
<hr>

:::: {.columns}

::: {.column width="50%"}
[**A Decision Tree for Data Visualization**]{.body-text-l .teal-text}

[The [From Data to Viz](https://www.data-to-viz.com/) website helps you:]{.body-text-m}

[- Navigate from your **data type** to the right chart]{.body-text-s}

[- Understand the **purpose** of each visualization]{.body-text-s}

[- See **real examples** with code (in R!)]{.body-text-s}

[- Avoid common **visualization pitfalls**]{.body-text-s}

[**Bookmark this!** It's an invaluable reference when you're stuck choosing a chart type.]{.body-text-s .teal-text}
:::

::: {.column width="50%"}
![](../images/lab-materials/data_to_viz.png){fig-align="center"}

[*Interactive decision tree walks you through fundamental chart selection*]{.body-text-s .gray-text}
:::

::::

[{{< fa link >}} [www.data-to-viz.com](https://www.data-to-viz.com/)]{.body-text-m}





## {#good-viz data-menu-title="good-viz"} 

[Once you have picked an appropiate graphic form, it's time to make your viz look its best!]{.slide-title}

<hr>

<br>

::: {.center-text .body-text-m}
Choosing the right graphic form is just the first step! It's important to consider how you can enhance your visualization by: 
:::

<br>

::: {.center-text}
{{< fa palette title="a paint palette" >}} applying pre-made and custom color palettes
:::

::: {.center-text}
{{< fa font title="a stylized capital letter 'A'" >}} updating fonts
:::

::: {.center-text}
{{< fa pencil title="pencil" >}} adding annotations
:::

::: {.center-text}
{{< fa chart-line title="a line chart with an upwards trending line" >}} fine-tuning themes
:::

::: {.center-text}
{{< fa highlighter title="highlighter" >}} centering our primary message
:::



## {#data-viz-hackathon data-menu-title="Data Viz Hackathon"}
[Data Viz Fundamental Chart Hackathon!]{.slide-title2}
<hr>
. . .

[Access Your Assigned Data]{.body-text-l .teal-text}

Now that you have drawn your dataset, find your specific folder in [this repository](https://github.com/EDS-240-Data-Viz/fundamental-charts-lab-data/tree/main)

. . .


[How to Load Data]{.body-text-l .teal-text}

To pull your data directly into R without downloading files to your computer:

1.  **Open** your assigned folder.
2.  **Click** on the `.csv` file.
3.  **Click the "Raw" button** at the top right of the file preview.
4.  **Copy the URL** from your browser's address bar.

```{r}
#| eval: false
#| echo: true

url <- "PASTE_YOUR_RAW_URL_HERE"
data <- read_csv(url)

```

