---
format: 
  revealjs:
    slide-number: true
    # code-link: true
    highlight-style: a11y
    chalkboard: true
    theme: 
      - ../../meds-slides-styles.scss
editor_options: 
  chunk_output_type: console
---

## {#title-slide data-menu-title="Title Slide" background="#047C91"} 

[EDS 240: Lab 5]{.custom-title}

[*Fundamental chart types in review*]{.custom-subtitle}

<hr class="hr-dark-blue">

[Week 4 | January 29^th^, 2026]{.custom-subtitle3}

---

## {#fundamental-charts data-menu-title="Fundamental charts"}

[We've learned how and when to create a number of "fundamental charts" so far!]{.slide-title2}

<hr>

---

## {#distributions data-menu-title="Distributions"}

[**Distributions**]{.body-text-m}
```{r load-pkgs}
#| eval: true
#| echo: false
library(palmerpenguins)
library(tidyverse)
library(ggridges)
library(ggbeeswarm)
```

:::: columns

::: {.column width="33%"}
::: {.center-text}
**Histograms**
:::
```{r penguin-histogram}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, fill = species)) +
  geom_histogram(alpha = 0.5, position = "identity")
```
:::

::: {.column width="33%"}
::: {.center-text}
**Density plots**
:::
```{r penguin-density}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, fill = species)) +
  geom_density(alpha = 0.5)
```
:::

::: {.column width="33%"}
::: {.center-text}
**Ridgeline plots**
:::
```{r penguin-ridgeline}
#| eval: true
#| echo: false
#| fig-align: "center"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  ggridges::geom_density_ridges(alpha = 0.5)
```
:::

::::

:::: columns

::: {.column width="50%"}
::: {.center-text}
**Box plots**
:::
```{r penguin-box}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "65%"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  geom_boxplot(alpha = 0.5)
```
:::

::: {.column width="50%"}
::: {.center-text}
**Violin plots**
:::
```{r penguin-violin}
#| eval: true
#| echo: false
#| fig-align: "center"
#| out-width: "65%"
ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +
  geom_violin(alpha = 0.5)
```
:::

::::

::: {.footer}
[Examples show the distribution of penguin body masses (g) for Adelie, Chinstrap & Gentoo penguins.]{.body-text-s .gray-text} 
:::

---

## {#distributions data-menu-title="Distribution considerations"}

[**Distribution Considerations**]{.slide-title2}

- Use when you have a lot of values with meaningful differences between those values 
- Avoid plotting too many groups at once
- Consider faceting
- Consider plotting fewer groups
- Modify bin/ bandwidths 
- Overlay histogram & density plots as a sanity check 
- If you have too many groups, consider: a ridgline plot, a box plot, or a violin plot!

---

## {#rankings data-menu-title="Rankings"}

[**Rankings**]{.body-text-m}
```{r}
#| eval: true
#| echo: false

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)
library(scales)

#..........................import data...........................
iwa_data <- read_csv(here::here("course-materials", "data", "lecture", "combined_iwa-assessment-outputs-conus-2025_CONUS_200910-202009_long.csv"))

#..................create df of subregions names.................
# data only contain HUC codes; must manually join names if we want to include those in our viz (which we do! we'll mainly be looking at CA subregions)
# subregions (& others) identified in: https://water.usgs.gov/GIS/wbd_huc8.pdf
# there may be a downloadable dataset containing HUCs & names out there...but I couldn't find it
subregion_names <- tribble(
  ~subregion_HUC, ~subregion_name,
  "1801", "Klamath-Northern California Coastal",
  "1802", "Sacramento",
  "1803", "Tulare-Buena Vista Lakes",
  "1804", "San Joaquin",
  "1805", "San Francisco Bay",
  "1806", "Central California Coastal",
  "1807", "Southern California Coastal",
  "1808", "North Lahontan", 
  "1809", "Northern Mojave-Mono Lake",
  "1810", "Southern Mojave-Salton Sea",
)

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                wrangle data                              ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#......create df with just CA water resource region (HUC 18).....
ca_region <- iwa_data |> 

  # make nicer column names ----
  clean_names() |> 

  # create columns for 2-unit (region-level) & 4-unit (subregion-level) HUC using full 12-unit HUC ----
  mutate(region_HUC = str_sub(string = huc12_id, start = 1, end = 2),
         subregion_HUC = str_sub(string = huc12_id, start = 1, end = 4)) |> 
  
  # filter for just CA region (HUC 18) ----
  filter(region_HUC == "18") |> 

  # separate year and month into two columns ----
  separate_wider_delim(cols = year_month,
                       delim = "-",
                       names = c("year", "month")) |> 

  # convert year and month from chr to num ---                            
  mutate(year = as.numeric(year),
         month = as.numeric(month)) |> 
  
  # join subregion names ----
  left_join(subregion_names) |> 
  
  # keep necessary columns & reorder in more logical way -----
  select(year, month, huc12_id, region_HUC, subregion_HUC, subregion_name, availab_mm_mo, consum_mm_mo, sui_frac)

# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# ##                            explore missing data                          ----
# ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# sub1805 <- ca_region |> 
#   filter(subregion_HUC == "1805") 

# see_NAs <- ca_region |> 
#   group_by(year) |> 
#   naniar::miss_var_summary() |>
#   filter(variable == "availab_mm_mo")

# avail <- sub1805 |> select(availab_mm_mo)
# missing_avail <- naniar::vis_miss(avail)
```

:::: columns

::: {.column width="33%"}
::: {.center-text}
**Bar Plots**
:::
```{r}
#| eval: true
#| echo: false
#| fig-align: "center"
ca_region |> 
  group_by(subregion_name) |> 
  summarise(mean_sui_2010_2020 = mean(sui_frac, na.rm = TRUE)) |> 
  ggplot(aes(x = subregion_name, y = mean_sui_2010_2020)) +
  geom_col() 
```
:::

::: {.column width="33%"}
::: {.center-text}
**Lollipop Plots**
:::
```{r basic-lollipop}
#| eval: true
#| echo: false
#| fig-align: "center"
ca_region |> 
  group_by(subregion_name) |> 
  summarise(mean_sui_2010_2020 = mean(sui_frac, na.rm = TRUE)) |> 
  ggplot(aes(x = subregion_name, y = mean_sui_2010_2020)) +
  geom_point() +
  geom_linerange(aes(ymin = 0, ymax = mean_sui_2010_2020))
```
:::

::: {.column width="33%"}
::: {.center-text}
**Dumbbell Plots**
:::
```{r dumbbell-example}
#| eval: true
#| echo: false
#| out-width: "70%"
#| fig-align: "center"
knitr::include_graphics(here::here("course-materials", "images", "lecture-slides", "dumbbell-example.png"))
```
:::

::::


[Considerations:]{.body-text-m} 

- Make space for long x axis labels (`coord_flip`)
- Reordering groups helps readers to draw quicker insights
- Add direct labels if the exact values are important
- Use bar plots for cateogorical data
-

---

## {#evolution data-menu-title="Evolution"}

[**Evolution**]{.body-text-m}

- line charts
- area plots

---

## {#relationships data-menu-title="Numeric Relationships"}

[**Numeric Relationships**]{.body-text-m}

- scatter plots
- 2d density plots
